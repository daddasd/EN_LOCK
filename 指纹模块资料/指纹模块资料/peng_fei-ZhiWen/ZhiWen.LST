C51 COMPILER V9.05   ZHIWEN                                                                05/25/2014 17:11:48 PAGE 1   


C51 COMPILER V9.05, COMPILATION OF MODULE ZHIWEN
OBJECT MODULE PLACED IN ZhiWen.OBJ
COMPILER INVOKED BY: D:\Keil\C51\BIN\C51.EXE ZhiWen.C BROWSE DEBUG OBJECTEXTEND

line level    source

   1          #include <reg52.h>
   2          #include <intrins.h>
   3          #include"lcd1602.h"
   4          
   5          
   6          sbit buzzer=P2^0;  //·äÃùÆ÷     µÍµçÆ½´ò¿ª·äÃùÆ÷
   7          
   8          sbit red=   P1^0;  //ºìÉ«µÆ ±íÊ¾ Â¼Èë Ä£Ê½ 
   9          sbit green= P1^1;  //ÂÌÉ«µÆ ±íÊ¾ Ê¶±ð Ä£Ê½
  10          
  11          sbit k1=P3^2; //Çå³ýËùÓÐÖ¸ÎÆ£¨10¸öÖ¸ÎÆÇå³ý£©
  12          sbit k2=P3^3; //Ä£Ê½Ê¶±ð×ª»»
  13          sbit k3=P3^4; //Â¼ÈëÒ»´ÎÖ¸ÎÆ
  14          
  15          #define Max_User 10
  16          #define error 2
  17             
  18          unsigned int    SaveNumber=0,searchnum=0;
  19          unsigned int    SearchNumber=0;         
  20          unsigned int    clk0=0;
  21          
  22          unsigned char str[6]={0,0,0,0,0,'\0'};
  23          
  24          unsigned char code Identify[16]="Lock:   Identify";
  25          unsigned char code Input[16]   ="Lock:   Input   ";
  26          
  27          bit modeflag=0,clearallflag=0,changeflag=0;
  28          
  29          // modeflag=0 ÎªÊ¶±ðÄ£Ê½ modeflag=1ÎªÂ¼ÈëÖ¸ÎÆÄ£Ê½
  30          //Ã¿³É¹¦Â¼ÈëÒ»´ÎÖ¸ÎÆ SaveNumber++
  31          
  32          //////////////////////////////////////³£ÓÃÖ¸Áî¶¨Òå/////////////////////////////
  33          
  34          //Verify  Password   £ºÑéÖ¤Éè±¸ÎÕÊÖ¿ÚÁî
  35          unsigned char code VPWD[16]={16,0X01 ,0Xff,0xff,0xff,0xff, 0x01,0,7,0x13,0x00,0x00,0x00,0x00,0x00,0x1b};         
             -//»ØËÍ12¸ö
  36          
  37          //ÉèÖÃÉè±¸ÎÕÊÖ¿ÚÁî
  38          unsigned char code STWD[16]={16,0X01 ,0Xff,0xff,0xff,0xff, 0x01,0,7,0x12,0x00,0x00,0x00,0x00,0x00,0x1a};         
             -//»ØËÍ12¸ö
  39          
  40          //GetImage           £ºÌ½²âÊÖÖ¸²¢´Ó´«¸ÐÆ÷ÉÏ¶ÁÈëÍ¼Ïñ
  41          unsigned char code GIMG[14]={12, 0X01 ,0Xff,0xff,0xff,0xff, 0x01, 0,3,1,0x00,0x05};     //»ØËÍ12¸ö
  42          
  43          //Gen Templet1        £º¸ù¾ÝÔ­Ê¼Í¼ÏñÉú³ÉÖ¸ÎÆÌØÕ÷1
  44          unsigned char code GENT1[14]={13,0X01 ,0Xff,0xff,0xff,0xff,0x01,0,4,2,1,0x00,0x08};     //»ØËÍ12¸ö
  45          
  46          //Gen Templet2        £º¸ù¾ÝÔ­Ê¼Í¼ÏñÉú³ÉÖ¸ÎÆÌØÕ÷2
  47          unsigned char code GENT2[14]={13,0X01 ,0Xff,0xff,0xff,0xff,0x01,0,4,2,2,0x00,0x09}; //»ØËÍ12¸ö  
  48          
  49                  
  50          //Search Finger      £ºÒÔCharBufferA»òCharBufferBÖÐµÄÌØÕ÷ÎÄ¼þËÑË÷Õû¸ö»ò²¿·ÖÖ¸ÎÆ¿â
  51          unsigned char code SEAT[18]={17,  0X01 ,0Xff,0xff,0xff,0xff, 0x01,   0,8, 4,1,0,0,    0,0x65,  0x00,0x73};
             -        //»ØËÍ16¸ö
  52          
C51 COMPILER V9.05   ZHIWEN                                                                05/25/2014 17:11:48 PAGE 2   

  53          
  54          //Merge Templet      ;½«CharBufferAÓëCharBufferBÖÐµÄÌØÕ÷ÎÄ¼þºÏ²¢Éú³ÉÄ£°å£¬½á¹û´æÓÚModelBuffer¡£
  55          unsigned char code MERG[14]={12,  0X01 ,0Xff,0xff,0xff,0xff, 0x01,  0,3,5 , 0x00,0x09};//»ØËÍ12¸ö       
  56          
  57          //Store Templet      £º½«ModelBufferÖÐµÄÎÄ¼þ´¢´æµ½flashÖ¸ÎÆ¿âÖÐ
  58          unsigned char code STOR[16]={15,  0X01 ,0Xff,0xff,0xff,0xff, 0x01,  0,6,6,2,     0x00,0x00,     0x00,0x0f}
             -; //»ØËÍ12¸ö
  59          
  60          //Read Note
  61          unsigned char code RDNT[14]={13,0X01 ,0Xff,0xff,0xff,0xff, 0x01, 0,4,0x19,  0, 0x00,0x1e};
  62          
  63          //Clear Note
  64          unsigned char code DENT[46]={45,0X01 ,0Xff,0xff,0xff,0xff, 0x01, 0,36,0x18,0,0,0,
  65          0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0x00,0x3d};
  66          
  67          //DEL one templet
  68          unsigned char code DELE_one[16]={16, 0X01 ,0Xff,0xff,0xff,0xff, 0x01,   0,7,  0x0c,    0x00,0x00, 0,1, 0x0
             -0,0x15};
  69          
  70          //DEL templet      ;Çå¿ÕÖ¸ÎÆ¿â
  71          unsigned char code DELE_all[12]={12,0X01 ,0Xff,0xff,0xff,0xff, 0x01, 0,3,  0x0d,0x00,0x11};
  72          
  73          //////////////////////////////////////³£ÓÃÖ¸Áî¶¨Òå-------½áÊø/////////////////////////////////////////////
             -//////////////////////////////////////////
  74          
  75          
  76          //////////////////////////////////////ºê¶¨Òå//////////////////////////////////////////////////////////////
             -//////////
  77          #define FALSE  0
  78          #define TURE   1
  79          #define ERROR  1001
  80          
  81          //×´Ì¬¶¨Òå±í
  82          #define on      1
  83          #define off     0
  84          
  85          #define MAX_NUMBER    63 
  86          #define _Nop()  _nop_()
  87          
  88          
  89          //////////////////////////////////////ºê¶¨Òå------------½áÊø//////////////////////////////////////////////
             -//////////
  90          
  91          unsigned char             FifoNumber=0; 
  92          xdata unsigned char   FIFO[MAX_NUMBER+1]={0};
  93          
  94          /*********1ºÁÃëÑÓÊ±³ÌÐò**********/
  95          void delay1ms(unsigned int t)
  96          {
  97   1              unsigned int i,j;
  98   1              for(i=0;i<t;i++)
  99   1                 for(j=0;j<120;j++)
 100   1                 ;
 101   1      }
 102          
 103          
 104          void TxdByte(unsigned char dat)//´®¿Ú·¢ËÍÐÅÏ¢,Í¨¹ý²éÑ¯·½Ê½·¢ËÍÒ»¸ö×Ö·û
 105          {
 106   1          TI = 0;              //ÈÃTI£½0
 107   1          SBUF = dat;  //¶ÁÈëÊý¾Ý
 108   1          while(!TI);  //µÈ´ý·¢ËÍÍê±Ï
 109   1          TI = 0;              //ÇåÁã
C51 COMPILER V9.05   ZHIWEN                                                                05/25/2014 17:11:48 PAGE 3   

 110   1      }
 111          
 112          bit Command(unsigned char *p,unsigned char MaxTime) //ÃüÁî½âÎö,¸øÄ£¿é·¢ËÍÒ»¸öÃüÁî
 113          {
 114   1              unsigned char count=0,tmpdat=0,temp=0,i=0,package=0,flag=0,checksum=0;
 115   1                      
 116   1              bit result=0, start=0,stop=0;
 117   1      
 118   1              TxdByte(0xef);//Êý¾Ý°ü°üÍ·Ê¶±ðÂë
 119   1              TxdByte(0x01);//Êý¾Ý°ü°üÍ·Ê¶±ðÂë
 120   1              i=*p;         //Êý×éµÄµÚ¡°0¡±¸öÔªËØ¡¢ÀïÃæ´æ·ÅÁË±¾Êý×éµÄ³¤¶È£¬°ÑÕâ¸ö³¤¶È¸ø±äÁ¿i£¬·½±ã½øÐÐ²Ù×÷
 121   1              p++; 
 122   1              p++;
 123   1              for (count=i-1; count!=1;count--)  //Sent command String
 124   1                      {
 125   2                              temp=*p++;//È¡µÚ¸ö¡°1¡±¸öÔªËØµÄÄÚÈÝ£¬È»ºó·¢ËÍ 
 126   2                      TxdByte(temp);//½«Êý¾Ý·¢ËÍ³öÈ¥
 127   2                      }  
 128   1              result=TURE;//·¢ËÍÍê³É,½á¹ûÎªÕæ (ÕæÎª1)         
 129   1              FifoNumber=0;
 130   1              for (count=MAX_NUMBER+1; count!=0; count--)//Çå¿ÕËùÓÐFIFO[]Êý×éÀïÃæµÄÄÚÈÝ£¬Ð´Èë0X00
 131   1                       FIFO[count-1]=0x00;  
 132   1              
 133   1              if (result)   
 134   1              {               
 135   2              result=FALSE;
 136   2              start =FALSE;
 137   2                      stop  =FALSE;
 138   2              count=0;
 139   2              clk0=0; //ÇåÁãCL0¼ÆÊý
 140   2                      
 141   2              do /////////////////////////////doµÄÄÚÈÝ////////////////////////////////
 142   2                      {       
 143   3                              restart0:                               
 144   3                              if (RI==1)//Èç¹û½ÓÊÕµ½Êý¾Ý
 145   3                              {                               
 146   4                                              tmpdat=SBUF;//ÏÈ°Ñ½ÓÊÕµ½µÄÊý¾Ý·Åµ½tmpdatÖÐ
 147   4                              RI=0;
 148   4                              if ((tmpdat==0xef)&&(start==FALSE))//Õâ¸öÊý¾ÝÎªµÚÒ»¸ö´«»ØÀ´µÄÊý¾Ý£¬Ò²¾ÍÊÇ¡°Ö¸ÁîÓ¦´ð¡±µÄµÚÒ»¸
             -ö×Ö½Ú
 149   4                                      { 
 150   5                                                              count=0;
 151   5                                                      FIFO[0]=tmpdat;//¶ÁÈëµÚÒ»¸öÓ¦´ð×Ö½Ú(0XEF)£¬´æÔÚµÚ¡°0¡±¸öÔªËØÖÐ    
 152   5                                                              flag=1; 
 153   5                                                              goto 
 154   5                                                                      restart0;//¿ÉÒÔÓÃÖÐ¶Ï·½Ê½½øÐÐ                   
 155   5                                                      
 156   5                                      }
 157   4                                              if(flag==1)//µÚÒ»¸ö×Ö½ÚÒÑ¾­»ØÀ´£¬ËùÒÔflag==1³ÉÁ¢
 158   4                                                      {  
 159   5                                                              if(tmpdat!=0x01)  //½ÓÊÕÊý¾Ý´íÎó£¬½«ÖØÐÂ´Ó»º³åÇø½ÓÊÕÊý¾Ý
 160   5                                                              {       
 161   6                                                                      flag=0;//½ÓÊÕÓ¦´ðÊ§°Ü
 162   6                                                                      result=FALSE;
 163   6                                                              start =FALSE;
 164   6                                                                      stop=FALSE;
 165   6                                                              count=0;
 166   6                                                                      goto 
 167   6                                                                              restart0;                                       
 168   6                                                              
 169   6                                                              }
 170   5                                                              //Èç¹û³É¹¦½ÓÊÕµ½0xef01£¬¿ÉÒÔ¿ªÊ¼½ÓÊÕÊý¾Ý
C51 COMPILER V9.05   ZHIWEN                                                                05/25/2014 17:11:48 PAGE 4   

 171   5                                                              flag=2;//flag=2;±íÊ¾Ó¦´ð³É¹¦£¬¿ÉÒÔ¿ªÊ¼½ÓÊÕÊý¾ÝÁË
 172   5                                                              count++;//ÏÖÔÚcount=1;
 173   5                                                              FIFO[count]=tmpdat;//¶ÁÈëµÚ¶þ¸öÓ¦´ð×Ö½Ú£¨0X01£©£¬´æÔÚµÚ¡°1¡±¸öÔªËØÖÐ    
 174   5                                                              start=TURE;     //Ó¦´ð³É¹¦¿ÉÒÔ¿ªÊ¼½ÓÊÕÊý¾Ý
 175   5                                                                  goto 
 176   5                                                                              restart0;       
 177   5                                                      }                  
 178   4                              if((flag==2)&&(start==TURE))//flag=2;±íÊ¾Ó¦´ð³É¹¦£¬¿ÉÒÔ¿ªÊ¼½ÓÊÕÊý¾ÝÁË
 179   4                                      {                                                        
 180   5                                                              count++; //Êý¾ÝÔªËØÏÂ±ê++
 181   5                                                  FIFO[count]=tmpdat;//´æÈëÊý¾Ý
 182   5                                                              if(count>=6)
 183   5                                                                      {
 184   6                                                                              checksum=FIFO[count]+checksum; //¼ÆËãÐ£ÑéºÍ
 185   6                                                                      }
 186   5                                                              if(count==8)
 187   5                                                                      { 
 188   6                                                                              package=FIFO[7]*0X100+FIFO[8];  //¼ÆËã°ü³¤¶È                                                    
 189   6                                                                              stop= TURE;
 190   6                                                                      }
 191   5                                                              if(stop)
 192   5                                                                      {                                               
 193   6                                                                              if(count==package+8)
 194   6                                                                              {
 195   7                                                                                      checksum=checksum-FIFO[count-1];
 196   7                                                                                      if(checksum!=FIFO[count]&0xff) 
 197   7                                                                                              result=FALSE; //Ð£ÑéÊ§°Ü,ÖÃ½á¹û±êÖ¾Îª0                                                  
 198   7                                                                                      else 
 199   7                                                                                              result=TURE;
 200   7                                                                                      flag=0;
 201   7                                                                                      break;
 202   7                                                                              } 
 203   6                                                                      }
 204   5                                      }
 205   4                              }
 206   3                }/////////////////////////////doµÄÄÚÈÝ----------------½áÊø////////////////////////////////
 207   2                         
 208   2                      while ((clk0<=MaxTime)&&(count<=MAX_NUMBER)&&(changeflag==0)); //ÓÉ¶¨Ê±Æ÷ÒÔ¼°×î´ó½ÓÊÕÊý¾ÝÀ´¿ØÖÆ£¬±£Ö¤²»»
             -áÔÚ´ËÒ»Ö±Ñ­»·
 209   2                        
 210   2              FifoNumber=count;       //±£´æ½ÓÊÕµ½µÄÊý¾Ý¸öÊý
 211   2               }
 212   1         return (result);
 213   1      }
 214          
 215          bit VefPSW(void)//ÑéÖ¤Éè±¸ÎÕÊÖ¿ÚÁî,³É¹¦·µ»Ø1     
 216          {
 217   1              unsigned char  count=0;
 218   1              while (1)
 219   1              {
 220   2              if(Command(VPWD,20) && (FifoNumber==11) && (FIFO[9]==0x00))  
 221   2                              return(1);
 222   2              count++;
 223   2                      if (count>=2)//Èç¹û²»³É¹¦£¬ÔÙÑéÖ¤Ò»´Î£¬Èç¹ûÁ½´Î²»³É¹¦£¬·µ»ØÊ§°Ü
 224   2                      {  
 225   3                          return(0);   
 226   3                           }
 227   2              }
 228   1      }
 229          
 230          
 231          void Clear_All(void) //Çå¿ÕËùÓÐÖ¸ÎÆÐÅÏ¢£¬Çå¿ÕÇ°Ê×ÏÈÑéÖ¤ºÍÖ¸ÎÆÄ£¿éÍ¨Ñ¶ÊÇ·ñÕý³£  
C51 COMPILER V9.05   ZHIWEN                                                                05/25/2014 17:11:48 PAGE 5   

 232          {
 233   1              if(VefPSW()!=1)//ÑéÖ¤Ê§°Ü
 234   1              {                       
 235   2                      
 236   2              }
 237   1              else              //ÑéÖ¤³É¹¦
 238   1              {                        
 239   2                      Command(DELE_all,50); //Çå¿ÕÖ¸ÎÆ¿â
 240   2                      Command(DENT,20);         //Çå¿ÕÓÃ»§¼ÇÊÂ±¾
 241   2              }
 242   1      }
 243          
 244          unsigned char ImgProcess(unsigned char BUFID)  //·¢»ñÈ¡Í¼Ïñ²¢Éú³ÉÌØÕ÷ÎÄ¼þ£¬´æÈëBUFIDÖÐ//ÊäÈë²ÎÊýÎª»º³åÇøºÅ
             -  
 245          {       
 246   1          if(Command(GIMG,89) && (FifoNumber==11) && (FIFO[9]==0x00))  
 247   1          {
 248   2                      if(BUFID==1)      
 249   2                      {                               
 250   3                      if(Command(GENT1,60) && (FifoNumber==11) && (FIFO[9]==0x00))  
 251   3                      {                                                       
 252   4                                      return 1;
 253   4                              }  
 254   3                      else
 255   3                      {
 256   4                                      return 0;
 257   4                      }
 258   3                       }
 259   2                      else if(BUFID==2)
 260   2                      {
 261   3                              if(Command(GENT2,60) && (FifoNumber==11) && (FIFO[9]==0x00))  
 262   3                      {                               
 263   4                                      return 1;
 264   4                              }  
 265   3                      else
 266   3                      {
 267   4                                      return 0;
 268   4                      }                       
 269   3                      }
 270   2          }
 271   1          else
 272   1          {
 273   2            return 0;       
 274   2          }
 275   1              return 0;             
 276   1      }
 277          
 278          bit Searchfinger(void)//ËÑË÷Ö¸ÎÆ(·¢ËÍËÑË÷ÃüÁî¡¢ÒÔ¼°¸ù¾Ý·µ»ØÖµÈ·¶¨ÊÇ·ñ´æÔÚ)        
 279          {               
 280   1              if(Command(SEAT,60) && (FifoNumber==15) && (FIFO[9]==0x00) )  
 281   1          {
 282   2                      SearchNumber=FIFO[10]*0x100+FIFO[11];//ËÑË÷µ½µÄÒ³Âë
 283   2                      //MatchScore=FIFO[12]*0x100+FIFO[13]   ¿ÉÒÔÔÚ´Ë¼ÆËãµÃ·Ö£¬´Ó¶ø½øÐÐ°²È«¼¶±ðÉè¶¨£¬±¾³ÌÐòºöÂÔ
 284   2                      return 1;
 285   2              }     
 286   1          else             
 287   1          {
 288   2              return 0;
 289   2          }  
 290   1      }
 291          
 292          
C51 COMPILER V9.05   ZHIWEN                                                                05/25/2014 17:11:48 PAGE 6   

 293          unsigned int search(void)//ËÑË÷ÓÃ»§ 
 294          {
 295   1              unsigned int SearchBuf=0,i=0;
 296   1              while (i<20)
 297   1          {
 298   2                 if(modeflag==0)//ÔÚÊ¶±ðÄ£Ê½ÏÂ
 299   2                 {
 300   3                       if (ImgProcess(1)==1)//Ê×ÏÈ¶ÁÈëÒ»´ÎÖ¸ÎÆ  
 301   3               {
 302   4                      SearchBuf=Searchfinger();//½øÐÐÖ¸ÎÆ±È¶Ô£¬Èç¹ûËÑË÷µ½£¬·µ»ØËÑË÷µ½µÄÖ¸ÎÆÐòºÅ
 303   4                      if(SearchBuf==1)         //³É¹¦ËÑË÷µ½Ö¸ÎÆºÅ
 304   4                      {
 305   5                              return SearchNumber; 
 306   5                      }
 307   4                      else  //Èç¹ûÃ»ÓÐËÑË÷µ½Ö¸ÎÆºÅ
 308   4                              {
 309   5                                 return 1001; //ÓÉÓÚÖ»ÄÜÂ¼Èë1000¸öÖ¸ÎÆ£¬ÕâÊ±ºòÈç¹û·µ»Ø255±íÊ¾Ê¶±ð´íÎó£¬»òÕßÕâ¸öÖ¸ÎÆÃ»ÓÐµÇ¼Ç
 310   5                              }     
 311   4              }
 312   3                 }
 313   2                      else
 314   2                      {
 315   3                         return 0;
 316   3                      }
 317   2                      i++;    
 318   2          }
 319   1         return 0;
 320   1      }
 321          
 322          bit savefingure(unsigned char ID)//±£´æÖ¸ÎÆ
 323          {
 324   1               unsigned char i=0;
 325   1               //ÏÖÔÚ¿ªÊ¼½øÐÐ´æ´¢Ö¸ÎÆÄ£°åµÄ²Ù×÷
 326   1           for (i=0;i<16;i++) //±£´æÖ¸ÎÆÐÅÏ¢
 327   1                      {
 328   2                              FIFO[i]=STOR[i];
 329   2                      }  
 330   1                      
 331   1               FIFO[11]=ID&0xFF00; 
 332   1           FIFO[12]=ID&0xFF; //°ÑÖ¸ÎÆÄ£°å´æ·ÅµÄPAGE_IDÒ²¾ÍÊÇFLASHµÄÎ»ÖÃ
 333   1           FIFO[14]=FIFO[14]+ID;      //Ð£ÑéºÍ
 334   1           if (Command(FIFO,70)==1)//²»³É¹¦·µ»Ø0      //´Ë´¦½øÐÐ´æ·ÅÖ¸ÎÆÄ£°åµÄÃü
 335   1                      {return(1);}
 336   1           else
 337   1                      {return(0);} //²»³É¹¦·µ»Ø0
 338   1      }
 339          
 340          
 341          
 342          unsigned char enroll(void) //²É¼¯Á½´ÎÖ¸ÎÆ£¬Éú³É1¸ö Ö¸ÎÆÄ£°å
 343          {
 344   1              unsigned char temp=0,count=0;
 345   1              while(1)
 346   1              {
 347   2                      temp=ImgProcess(1); //Éú³ÉÌØÕ÷1    
 348   2                      if (temp==1)//Éú³ÉÌØÕ÷ÎÄ¼þ³É¹¦             
 349   2              {                     
 350   3                      break;
 351   3              }
 352   2              else                   
 353   2              {
 354   3                      if (temp==0)//²É¼¯Ö¸ÎÆÃ»ÓÐ³É¹¦
C51 COMPILER V9.05   ZHIWEN                                                                05/25/2014 17:11:48 PAGE 7   

 355   3                      { 
 356   4                                      count++;
 357   4                      if (count>=40)//Èç¹û²É¼¯ÁË40´Î£¬»¹²»³É¹¦£¬Ö±½Ó²É¼¯Ê§°Ü£¬Ö±½ÓÍË³öenrollº¯Êý£­£­£­£­·µ»Ø0  
 358   4                                              return(0);
 359   4                  }
 360   3              }
 361   2              }
 362   1              //²É¼¯µÚÒ»¸öÌØÕ÷³É¹¦ 
 363   1              count=0;  
 364   1              buzzer=0;
 365   1              delay1ms(100);
 366   1              buzzer=1;
 367   1              delay1ms(2000);//ÑÓÊ±2S¿ªÊ¼²É¼¯ÏÂÒ»¸öÌØÕ÷
 368   1      
 369   1              //¿ªÊ¼²É¼¯µÚ¶þ¸öÌØÕ÷ 
 370   1              while(1)
 371   1              {
 372   2                      temp=ImgProcess(2); //Éú³ÉÌØÕ÷2    
 373   2                      if (temp==1)//Éú³ÉÌØÕ÷ÎÄ¼þ2³É¹¦
 374   2              {
 375   3                      if (  (Command(MERG,40)&& (FifoNumber==11) && (FIFO[9]==0x00))==0  ) //ºÏ²¢²»³É¹¦·µ»Ø0£¬³É¹¦·µ»Ø1
 376   3                              {
 377   4                                      return 0;
 378   4                              }       
 379   3                              else//ÌØÕ÷ÎÄ¼þºÏ²¢Éú³ÉÄ£°å£¬½á¹û´æÓÚModelBuffer
 380   3                              {
 381   4                                       buzzer=0;
 382   4                           delay1ms(100);
 383   4                           buzzer=1;
 384   4                                       delay1ms(100);
 385   4                                       buzzer=0;
 386   4                           delay1ms(100);     //ÏìÁ½Éù£¬±íÊ¾Éú³ÉÒ»¸öÄ£°å³É¹¦
 387   4                           buzzer=1;
 388   4                           return 1;
 389   4                              }       
 390   3              }
 391   2              else      
 392   2              {       
 393   3                      if (temp==1)//²É¼¯Ö¸ÎÆÃ»ÓÐ³É¹¦
 394   3                      {
 395   4                                      count++;
 396   4                                      
 397   4                                      if (count>=25) 
 398   4                                      
 399   4                                      return(0);
 400   4                      }
 401   3              }
 402   2              }
 403   1      }
 404          
 405          
 406          void shownum(unsigned int dat)
 407          {
 408   1              unsigned int numdat=0;
 409   1              numdat=dat;
 410   1              GotoXY(0,1);//x,y
 411   1              Print("Finger:");
 412   1              GotoXY(0,8);//x,y
 413   1              if(numdat<1000)//Ö¸ÎÆÄ£¿éÖ»ÄÜ´æ1000¸öÖ¸ÎÆ
 414   1              {
 415   2                  str[0]=0x30+numdat/100;      //°Ù Î»×ª»»³ÉASCIIÂë
 416   2                      str[1]=0x30+(numdat%100)/10; //Ê® Î»×ª»»³ÉASCIIÂë
C51 COMPILER V9.05   ZHIWEN                                                                05/25/2014 17:11:48 PAGE 8   

 417   2                      str[2]=0x30+numdat%10;           //¸ö Î»×ª»»³ÉASCIIÂë
 418   2                      str[3]=' ';
 419   2                      str[4]=' ';     
 420   2                      Print(str);
 421   2              }
 422   1              if(numdat==ERROR)//±íÊ¾Ê¶±ð´íÎó
 423   1              {
 424   2                 Print("Error");
 425   2              }
 426   1              
 427   1              
 428   1      }
 429          
 430          void changeState(void)
 431          {
 432   1      
 433   1         GotoXY(0,0);//x,y
 434   1         if(modeflag==0)
 435   1         {
 436   2              Print(Identify);//ÏÔÊ¾ Ê¶±ðÄ£Ê½  Indentity
 437   2              green=0;
 438   2              red=1;
 439   2         }
 440   1         else
 441   1         {
 442   2              Print(Input);   //ÏÔÊ¾  ÊäÈëÄ£Ê½ Input
 443   2              green=1;
 444   2              red=0;
 445   2         }
 446   1         changeflag=0;
 447   1         shownum(0);          
 448   1      }
 449          
 450          
 451          
 452          
 453          void main(void)//Ö÷º¯Êý
 454          {
 455   1              unsigned char i=0;
 456   1      
 457   1              ET0=1;     //¶¨Ê±Æ÷0¿ªÖÐ¶Ï
 458   1              TL0=0x97;  //17msµÄ³õÖµ
 459   1              TH0=0xBD;
 460   1         delay1ms(5);
 461   1         LcdRw=0;      //Ö»¶ÔÒº¾§½øÐÐÐ´²Ù×÷£¬²»½øÐÐ¶Á²Ù×÷
 462   1         delay1ms(5);
 463   1         LCD_Initial();//Òº¾§³õÊ¼»¯
 464   1         delay1ms(5); 
 465   1         GotoXY(0,0);//x,y
 466   1         Print(Identify);
 467   1      
 468   1          //´®¿Ú³õÊ¼»¯ 
 469   1          SCON=0x50;   //UART·½Ê½1:8Î»UART;   REN=1:ÔÊÐí½ÓÊÕ 
 470   1          PCON=0x00;   //SMOD=0:²¨ÌØÂÊ²»¼Ó±¶ 
 471   1          TMOD=0x21;   //T1·½Ê½2,ÓÃÓÚUART²¨ÌØÂÊ
 472   1          TH1=0xFD; 
 473   1          TL1=0xFD;   //UART²¨ÌØÂÊÉèÖÃ:9600
 474   1          TR1=1; 
 475   1          TR0=1;// ¿ª¶¨Ê±Æ÷0
 476   1              
 477   1              IT0=0;//ÖÐ¶Ï0µÍµçÆ½ÖÐ¶Ï
 478   1              IT1=1;//ÖÐ¶Ï1µÍµçÆ½ÖÐ¶Ï
C51 COMPILER V9.05   ZHIWEN                                                                05/25/2014 17:11:48 PAGE 9   

 479   1              EX0=1;//¿ªÖÐ¶Ï0
 480   1              EX1=1;//¿ªÖÐ¶Ï1
 481   1          EA=1;
 482   1      
 483   1              
 484   1      
 485   1              for(i=0;i<6;i++)//¿ªÊ¼ÎÕÊÖ6´Î£¬Èç¹ûÃ»ÓÐÒ»´Î³É¹¦£¬±íÊ¾Ä£¿éÍ¨ÐÅ²»Õý³£¡£Ö»Òª³É¹¦¾ÍÌø³ö´ËÑ­»·
 486   1              {
 487   2                      if(VefPSW())//ÓëÄ£¿éÎÕÊÖÍ¨¹ý£¬ÂÌµÆÁÁÆð¡£½øÈëÊ¶±ðÄ£Ê½
 488   2                        {
 489   3                                      green=0; //¶ÁÒ»´Î
 490   3                                      buzzer=0;
 491   3                                      shownum(0);
 492   3                              delay1ms(300);
 493   3                              buzzer=1;
 494   3                                      break;  
 495   3                        }
 496   2                  else
 497   2                       {
 498   3                              red=1; 
 499   3                              green=1;
 500   3                              break;
 501   3      
 502   3                       }
 503   2              }
 504   1      
 505   1          while(1)
 506   1              {
 507   2                      
 508   2                      if(k3==0)//Â¼ÈëÒ»¸öÖ¸ÎÆ
 509   2                      {
 510   3                      delay1ms(10);   
 511   3                      if(k3==0)//Èç¹ûÈÔÎªµÍµçÆ½£¬±íÊ¾°´¼üÓÐÐ§
 512   3                              {
 513   4                                while(k3==0);//µÈ´ýËÉÊÖ
 514   4                                if(VefPSW()==1&&modeflag==1&&SaveNumber<1000)//ÓëÄ£¿éÎÕÊÖÍ¨¹ý
 515   4                                        {
 516   5                                                if(enroll()==1)//²É¼¯Á½´Î£¬Éú³É1¸öÖ¸ÎÆÄ£°å³É¹¦
 517   5                                                      {
 518   6                                                         if(savefingure(SaveNumber+1)==1)//±£´æÒ²³É¹¦
 519   6                                                              {
 520   7                                                                      SaveNumber++;//¼ÓÒ»´Î
 521   7                                                                      shownum(SaveNumber);
 522   7                                                              }
 523   6              
 524   6                                                      }
 525   5                                        }
 526   4                                      else
 527   4                                      {
 528   5                                                      buzzer=0; 
 529   5                                                      for(i=0;i<8;i++)
 530   5                                                      {
 531   6                                                        delay1ms(100);
 532   6                                                        red=~red;
 533   6                                                      }
 534   5                                                      red=0;
 535   5                                                      buzzer=1;               
 536   5                                      }       
 537   4                              }
 538   3                                              
 539   3                      }
 540   2      
C51 COMPILER V9.05   ZHIWEN                                                                05/25/2014 17:11:48 PAGE 10  

 541   2                      if(modeflag==0)//ÎªÊ¶±ðÄ£Ê½
 542   2                      {
 543   3                                searchnum=search();
 544   3                                if(searchnum>=1&&searchnum<=1000)//×î¶àÖ»ÄÜ´æ´¢1000¸öÖ¸ÎÆ
 545   3                                {
 546   4                                          //ÏÔÊ¾ËÑË÷µ½µÄÖ¸ÎÆºÅ
 547   4                                              shownum(searchnum);
 548   4                                              
 549   4                                     //·äÃùÆ÷ÏìÒ»Éù
 550   4                                     buzzer=0;
 551   4                                     delay1ms(100);
 552   4                                     buzzer=1;
 553   4                                }
 554   3                                if(searchnum==ERROR)//±íÊ¾·ÅÉÏÁËÃ»ÓÐµÇ¼ÇµÄÖ¸ÎÆ»òÕßÊ¶±ð´íÎó
 555   3                                {
 556   4                                    shownum(searchnum);
 557   4                                         //·äÃùÆ÷ÏìÈýÉù
 558   4                                     buzzer=0;delay1ms(100); buzzer=1;delay1ms(100);
 559   4                                     buzzer=0;delay1ms(100); buzzer=1;delay1ms(100);
 560   4                                     buzzer=0;delay1ms(100); buzzer=1;
 561   4                                }
 562   3                      }
 563   2      
 564   2                      if(clearallflag==1)
 565   2                      {
 566   3                              clearallflag=0;
 567   3                              Clear_All();
 568   3                          red=0;           //ºìÉ«µÆÁÁ
 569   3                          green=1;
 570   3                              //·äÃùÆ÷³¤ÏìÒ»´Î£¬±íÊ¾Çå³ýËùÓÐÖ¸ÎÆ½áÊø
 571   3                              modeflag=1;//½øÈëÂ¼ÈëÖ¸ÎÆÄ£Ê½
 572   3                              GotoXY(0,0);//x,y
 573   3                              Print(Input);
 574   3                              shownum(0);
 575   3                              buzzer=0;
 576   3                              delay1ms(800);
 577   3                              buzzer=1;
 578   3                              SaveNumber=0;
 579   3                      }
 580   2      
 581   2                      if(changeflag==1)
 582   2                      {
 583   3                         changeState();
 584   3                         changeflag=0;
 585   3                      }
 586   2      
 587   2              }////////////////////////////while(1)½áÊø////////////////////////////////
 588   1              
 589   1      }
 590          
 591          
 592          void int0(void) interrupt 0//ÖÐ¶Ï0£¬Çå³ýËùÓÐÖ¸ÎÆ
 593          {
 594   1              if(k1==0) //Çå³ýËùÓÐÖ¸ÎÆ
 595   1              {
 596   2                      delay1ms(10);
 597   2                      if(k1==0)//Èç¹ûÈÔÎªµÍµçÆ½£¬±íÊ¾°´¼üÓÐÐ§
 598   2                      {
 599   3                              while(k1==0);//µÈ´ýËÉÊÖ 
 600   3                              clearallflag=1;
 601   3                      }       
 602   2              }       
C51 COMPILER V9.05   ZHIWEN                                                                05/25/2014 17:11:48 PAGE 11  

 603   1      } 
 604          
 605          void  Timer0(void) interrupt 1//¶¨Ê±Æ÷0ÖÐ¶Ïº¯Êý
 606          {
 607   1              TL0=0x97;
 608   1              TH0=0xBD;
 609   1              clk0++;   //ÑÓÊ±17ms
 610   1      }
 611          
 612          
 613          void int1(void) interrupt 2//ÖÐ¶Ï1£¬Ä£Ê½×ª»»
 614          {
 615   1              if(k2==0)//Ä£Ê½×ª»» ÆäÖÐÓÃmodeflag À´±êÖ¾,Ä¬ÈÏ´ÓµÚ1¸öÖ¸ÎÆ¿ªÊ¼Â¼Èë
 616   1              {
 617   2                delay1ms(10); 
 618   2                if(k2==0)//Èç¹ûÈÔÎªµÍµçÆ½£¬±íÊ¾°´¼üÓÐÐ§
 619   2                      {
 620   3                              while(k2==0);//µÈ´ýËÉÊÖ
 621   3                              modeflag=~modeflag;//0±íÊ¾Â¼ÈëÖ¸ÎÆ  1±íÊ¾Ê¶±ðÖ¸ÎÆ
 622   3                              changeflag=1;//±íÊ¾Ä£Ê½ÓÐ±ä»¯
 623   3                      }       
 624   2              }       
 625   1      }
 626          
 627          
 628          
 629          
 630          
 631          
 632          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   1559    ----
   CONSTANT SIZE    =    256    ----
   XDATA SIZE       =     64    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     15      18
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      3       3
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
